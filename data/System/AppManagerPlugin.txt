%META:TOPICINFO{author="BaseUserMapping_333" comment="pending" date="1445591316" format="1.1" version="3"}%
%META:TOPICPARENT{name="Plugins"}%

%TOC%

---++ Documentation
[[System.AppManager][Click to go to the app management site]].
---
The AppManagerPlugin is used to install Applications for Q.wiki. Any kind of Foswiki extension (Contrib or Plugin) can be defined
as an installable app. In order to be recognised as an installable app the Contrib/Plugin has to provide an appconfig.json file anywhere
under lib/Foswiki.

---+++ _appconfig.json_
The appconfig.json file has to define an app configuration object. The following settings are available (mandatory settings are written in bold)
   * __appname__: The application name. This has to be the name of the Contrib/Plugin.
   * __description__: The application description. It may contain HTML markup or the empty string.
   * __installConfigs__: Array of installation configuration objects. The first object in the array will be considered as the default installation.
      * __name__: Name of the installation.
      * __destinationWeb__: Name of the web in which the app should be installed.
      * _webPreferences_: An array of objects defining preferences to be set in the WebPreferences. Will be skipped when web starts with an underscore '_'.
         * __name__: The name of the preference.
         * __value__: The value of the preference. Use =&{...}= to get the value of a setting, eg. =&{destinationWeb}= will expand to the destination web.
         * __pattern__: Regex to apply to the _current_ value (left hand of a =s/pattern/.../g= substitution); fallback to __value__ when it does not match; fallback to original value, when __value__ is not set. You can also use the =&{...}= syntax.
         * __format__: Format to apply to the regex result (right hand of a =s/.../format/g= substitution). You can also use the =&{...}= syntax.
         * __remove__: Remove this setting, when perl-true.
         * __altHeading__: If setting does not exist yet, attempt to put it after this heading.
            * When the heading does not exist: create it.
            * When this is an array, search for each entry and create the first one, should none be found.
            * defaults to =['Modell Aachen Settings', 'Project Settings']=
      * _sitePreferences_: Same as _webPreferences_, but applies to [[%QUERY{"{LocalSitePreferences}"}%]]
      * _webHomeConfig_: An object defining how WebHome should be generated.
         * __viewTemplate__: The view template used for rendering WebHome. It needs to be installed in the System web.
         * __topicTitle__: The TopicTitle of the WebHome Topic.
         * _preferences_: An array of objects defining additional preferences to be set for WebHome.
            * __name__: The name of the preference.
            * __value__: The value of the preference.
      * _webActionsConfig_: An object defining how WebActions should be generated.
         * __sourceTopic__: The name of the topic which defines the WebAction contents. It needs to be installed in the System web.
      * _formConfigs_: An array of objects defining which forms should be generated. The AppManager only generates FormManagers based on this config. The actual forms are then generated by the [[System.FormGeneratorPlugin][FormGenerator]].
         * __formName__: The name of the form to be generated.
         * __formGroup__: The name of the form group. Appropriate FormGenerators need to be installed in advance.
      * _groups_: An object describing which groups to create and members to add. E.g.: _{ GreatGroup: ["AdminUser"] }_. Use an empty array to create an empty group (if it does not already exist).
      * _appContent_: Either an array of app content configurations or a single app content configuration object.
         * __baseDir__: The web from which content needs to be copied or linked.
         * __targetDir__: The web to which content should be copied. If not set it defaults to the destinationWeb.
         * __ingore__: An array of topic names or regexes to ignore from copying.
         * __alwaysCopy__: An array of regexes, that overwrite __ignore__ and also _devirtualize_ topics.
         * __link__: An array of topic names to be linked instead of copied.
      * _subConfigs_: Instead of setting all the install configurations above (except for name) this config can be set to an array of installation configuration objects. This way the installation can be split into multiple installation subparts. See the example below to get the idea.

<pre>
{
    "appname": "ProcessesContentContrib",
    "description": "",
    "installConfigs": [
        {
            "name": "Standard",
            "destinationWeb": "Processes",
            "appContent": {
                "baseDir": "_apps/Processes",
                "ignore": [
                    "DocumentFormManager",
                    "WebAtom",
                    "WebChanges",
                    "WebContentTemplates",
                    "WebCreateNewTopic",
                    "WebIndex",
                    "WebNotify",
                    "WebPreferences",
                    "WebRss",
                    "WebSearchAdvanced",
                    "WebSearch",
                    "WebStatistics",
                    "WebTools",
                    "WebTopicList"
                ]
            },
            "formConfigs": [
                {
                    "formName": "DocumentForm",
                    "formGroup": "ProcessesContentContrib"
                }
            ]
        },
        {
            "name":"Multisite",
            "subConfigs": [
                {
                    "name": "Multisite Processes",
                    "destinationWeb": "Settings/Processes",
                    "webHomeConfig": {
                        "viewTemplate": "ProcessesWebHomeView",
                        "copy": "true"
                    },
                    "appContent": [
                        {
                            "baseDir":"_apps/Processes",
                            "ignore":[
                                "AenderungenInDerAblauforganisationEinbringenUndKommunizieren",
                                "ArbeitsanweisungTemplate",
                                "BewertungsschemaRisiken",
                                "DocumentApprovalWorkflow",
                                "DocumentFormManager",
                                "InfoseiteTemplate",
                                "InterneAuditsPlanenDurchfuehren",
                                "KontinuierlicheVerbesserung",
                                "ProzessbeschreibungTemplate",
                                "RegelmaessigeBesprechungenOrganisierenUndDurchfuehren",
                                "RisikomanagementEinfuehrenUndLeben",
                                "RollenQwiki"
                            ]
                        },
                        {
                            "baseDir":"_apps/GlobalProcessesTemplate",
                            "ignore":[
                                "WebPreferences"
                            ]
                        }
                    ],
                    "formConfigs": [
                        {
                            "formName": "GlobalDocumentForm",
                            "formGroup": "MultisiteAppContribGlobalDocument"
                        },
                        {
                            "formName": "LocalDocumentForm",
                            "formGroup": "MultisiteAppContribLocalDocument"
                        },
                        {
                            "formName": "LocalStructureDocumentForm",
                            "formGroup": "MultisiteAppContribLocalStructure"
                        }
                    ]
                },
                {
                    "name": "Multisite to OUTemplates",
                    "destinationWeb": "OUTemplate/Processes",
                    "webPreferences": [
                        {
                            "name": "WORKFLOW",
                            "value": "Settings/Processes.GlobalDocumentApprovalWorkflow"
                        },
                        {
                            "name": "CONTENTTEMPLATEWEB",
                            "value": "<new web>, Settings.Processes"
                        },
                        {
                            "name": "GLOSSARY",
                            "value": "GlossaryDE, GlossaryEN, <this web>.Glossary"
                        }
                    ],
                    "appContent": [
                        {
                            "baseDir":"Settings/Processes",
                            "ignore":[
                                "AenderungenInDerAblauforganisationEinbringenUndKommunizieren",
                                "BewertungsschemaRisiken",
                                "GlobalInfopageTemplate",
                                "GlobalPolicyTemplate",
                                "GlobalDocumentApprovalWorkflow",
                                "GlobalDocumentForm",
                                "GlobalDocumentFormManager",
                                "GlobalProcessTemplate",
                                "GlobalWorkinstructionTemplate",
                                "LocalDocumentForm",
                                "LocalDocumentFormManager",
                                "LocalStructureDocumentForm",
                                "LocalStructureDocumentFormManager",
                                "InterneAuditsPlanenDurchfuehren",
                                "KontinuierlicheVerbesserung",
                                "RegelmaessigeBesprechungenOrganisierenUndDurchfuehren",
                                "RisikomanagementEinfuehrenUndLeben",
                                "RollenQwiki",
                                "WebAtom",
                                "WebChanges",
                                "WebContentTemplates",
                                "WebCreateNewTopic",
                                "WebIndex",
                                "WebStatistics"
                            ],
                            "link":[
                                "Responsibilities",
                                "ResponsibilitiesViewTemplate",
                                "Templates",
                                "TemplatesViewTemplate",
                                "WebRss",
                                "WebSearch",
                                "WebSearchAdvanced",
                                "WebTools",
                                "WebTopicList",
                                "WorkflowManagement",
                                "WorkflowManagementViewTemplate"
                            ]
                        }
                    ],
                    "formConfigs": [
                        {
                            "formName": "DocumentForm",
                            "formGroup": "ProcessesContentContrib"
                        }
                    ]
                }
            ]
        }
    ]
}

</pre>

---+++ Web Interface
Applications can be managed via the [[System.AppManager][AppManager]] site.

---+++ CLI

The AppManagerPlugin installs an CLI tool under <pre>FOSWIKI_ROOT_DIR/tools/appmanager</pre> which can also be used to manage apps.
Just run the tool without any parameters to print its help text.

---++ Installation

---++ Plugin Info

|  Authors: | Modell Aachen GmbH |
|  Copyright: | &copy; 2015, Modell Aachen GmbH |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Release: | %$RELEASE% |
|  Version: | %$VERSION% |
|  Change&nbsp;History: | <!-- versions below in reverse order -->&nbsp; |
|  0.1 | First functional prototype. |
|  Home: | http://modell-aachen.de |
